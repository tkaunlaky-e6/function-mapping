{
  "function_name": "CONCAT_WS",
  "dialect": "spark",
  "signature": "CONCAT_WS(separator, arg1, arg2, ..., argN)",
  "description": "Concatenates string representations of values with a separator string. NULL separator returns NULL. NULL arguments are skipped. Arrays are expanded into their elements.",
  
  "parameter_analysis": {
    "separator": {
      "real_domain": "All scalar types + NULL",
      "partitions": [
        {
          "partition": "sep=NULL",
          "description": "Separator is NULL",
          "representative": "NULL",
          "behavior": "Returns NULL regardless of other arguments"
        },
        {
          "partition": "sep=empty_string",
          "description": "Separator is empty string",
          "representative": "''",
          "behavior": "Concatenates values without gap"
        },
        {
          "partition": "sep=single_char",
          "description": "Separator is single character string",
          "representative": "','",
          "behavior": "Standard separator insertion between values"
        },
        {
          "partition": "sep=multi_char",
          "description": "Separator is multi-character string",
          "representative": "'|||'",
          "behavior": "Full separator string inserted between values"
        },
        {
          "partition": "sep=non_string",
          "description": "Separator is non-string scalar (int, decimal, boolean, date, timestamp)",
          "representative": "1",
          "behavior": "Implicitly cast to string before use"
        }
      ],
      "spanning_proof": "Domain = {NULL} ∪ {empty string} ∪ {non-empty strings} ∪ {non-string scalars}. Partitions: NULL covers NULL case; empty/single/multi covers all strings by length; non-string covers remaining scalars. Union spans all possible separator inputs."
    },
    "args": {
      "real_domain": "Variadic: 0 to N arguments, each can be any scalar type, array, or NULL",
      "partitions": [
        {
          "partition": "no_args",
          "description": "Zero arguments after separator",
          "representative": "[]",
          "behavior": "Returns empty string"
        },
        {
          "partition": "all_args_null",
          "description": "All arguments are NULL",
          "representative": "[NULL, NULL, NULL]",
          "behavior": "All NULLs skipped, returns empty string"
        },
        {
          "partition": "single_survivor",
          "description": "Exactly one non-NULL argument (may have NULLs too)",
          "representative": "['a']",
          "behavior": "Returns the single value, separator not used"
        },
        {
          "partition": "multi_string",
          "description": "Multiple non-NULL string arguments",
          "representative": "['a', 'b', 'c']",
          "behavior": "Standard joining with separator"
        },
        {
          "partition": "null_skip",
          "description": "Mix of NULL and non-NULL arguments",
          "representative": "['a', NULL, 'b']",
          "behavior": "NULLs skipped, non-NULLs joined"
        },
        {
          "partition": "empty_strings_preserved",
          "description": "Arguments include empty strings",
          "representative": "['', 'a', '']",
          "behavior": "Empty strings preserved (≠ NULL), can create consecutive separators"
        },
        {
          "partition": "int_args",
          "description": "Integer arguments",
          "representative": "[1, 2, 3]",
          "behavior": "Integers cast to string"
        },
        {
          "partition": "decimal_args",
          "description": "Decimal arguments",
          "representative": "[1.5, 2.75]",
          "behavior": "Decimals cast to string with precision preserved"
        },
        {
          "partition": "negative_numbers",
          "description": "Negative numeric arguments",
          "representative": "[-1, -2.5]",
          "behavior": "Negatives cast to string with sign preserved"
        },
        {
          "partition": "boolean_args",
          "description": "Boolean arguments",
          "representative": "[TRUE, FALSE]",
          "behavior": "Booleans cast to lowercase strings 'true'/'false'"
        },
        {
          "partition": "date_arg",
          "description": "Date argument",
          "representative": "[DATE '2024-01-01']",
          "behavior": "Date cast to ISO format string"
        },
        {
          "partition": "timestamp_arg",
          "description": "Timestamp argument",
          "representative": "[TIMESTAMP '2024-01-01 10:30:00']",
          "behavior": "Timestamp cast to string with default format"
        },
        {
          "partition": "array_strings",
          "description": "Array of strings",
          "representative": "[array('a', 'b')]",
          "behavior": "Array expanded into individual elements"
        },
        {
          "partition": "array_with_nulls",
          "description": "Array containing NULLs",
          "representative": "[array('a', NULL, 'b')]",
          "behavior": "NULLs inside arrays skipped like scalar NULLs"
        },
        {
          "partition": "empty_array",
          "description": "Empty array",
          "representative": "[array()]",
          "behavior": "No elements to join"
        },
        {
          "partition": "array_scalar_mix",
          "description": "Mix of array and scalar arguments",
          "representative": "[array('a', 'b'), 'c']",
          "behavior": "Arrays expanded, then all joined with scalars"
        },
        {
          "partition": "mixed_types",
          "description": "Multiple different types in arguments",
          "representative": "[1, 'text', TRUE, NULL]",
          "behavior": "All types cast to string, NULLs skipped"
        },
        {
          "partition": "nested_functions",
          "description": "Function expressions as arguments",
          "representative": "[UPPER('abc'), LOWER('XYZ')]",
          "behavior": "Expressions evaluated, results joined"
        },
        {
          "partition": "array_integers",
          "description": "Array of integers",
          "representative": "[array(1, 2, 3)]",
          "behavior": "Integer array elements cast to string"
        },
        {
          "partition": "multiple_empty_arrays",
          "description": "Multiple empty arrays",
          "representative": "[array(), array()]",
          "behavior": "No elements from any array"
        },
        {
          "partition": "multiple_arrays_scalar",
          "description": "Multiple arrays with scalars",
          "representative": "[array('x'), 'y', array('z')]",
          "behavior": "All arrays expanded, joined with scalars"
        }
      ],
      "spanning_proof": "Domain = {0 args} ∪ {1+ args each of type (NULL | scalar | array)}. Partitions cover: zero args; all NULL; single survivor; multiple non-NULL (by type: string, empty string, int, decimal, negative, boolean, date, timestamp); array cases (empty, with nulls, mixed with scalars, integer arrays, multiple arrays); mixed types; expressions. Every possible argument configuration falls into at least one partition. Union spans entire variadic domain."
    }
  },
  
  "output_range": {
    "type": "STRING | NULL",
    "bounds": [
      "NULL when separator is NULL",
      "Empty string when no arguments or all arguments are NULL/empty arrays",
      "Non-empty strings otherwise"
    ],
    "properties": [
      "Output contains all non-NULL arguments (cast to string)",
      "Output length ≥ sum of survivor argument lengths",
      "Number of separators = max(0, number of survivors - 1)",
      "Empty strings in arguments are preserved (≠ NULL)",
      "Arrays are flattened into the argument list"
    ]
  },
  
  "codomain_classes": [
    {
      "class": "O_NULL",
      "description": "NULL output",
      "condition": "Separator is NULL",
      "representative_query": "SELECT CONCAT_WS(NULL, 'a', 'b')"
    },
    {
      "class": "O_EMPTY",
      "description": "Empty string output",
      "condition": "No arguments, or all arguments are NULL, or all arrays empty",
      "representative_queries": [
        "SELECT CONCAT_WS(',')",
        "SELECT CONCAT_WS(',', NULL, NULL, NULL)",
        "SELECT CONCAT_WS(',', array())",
        "SELECT CONCAT_WS(',', array(), array())"
      ]
    },
    {
      "class": "O_SINGLE",
      "description": "Single value without separator",
      "condition": "Exactly one non-NULL survivor after NULL skipping",
      "representative_queries": [
        "SELECT CONCAT_WS(',', 'a')",
        "SELECT CONCAT_WS(',', DATE '2024-01-01')",
        "SELECT CONCAT_WS(',', TIMESTAMP '2024-01-01 10:30:00')"
      ]
    },
    {
      "class": "O_JOINED",
      "description": "Multiple values joined with separator",
      "condition": "Two or more non-NULL survivors",
      "representative_queries": [
        "SELECT CONCAT_WS(',', 'a', 'b', 'c')",
        "SELECT CONCAT_WS(',', 'a', NULL, 'b')",
        "SELECT CONCAT_WS(',', 1, 2, 3)",
        "SELECT CONCAT_WS(',', TRUE, FALSE)",
        "SELECT CONCAT_WS(',', array('a', 'b'))",
        "SELECT CONCAT_WS(',', 1, 'text', TRUE, NULL)"
      ]
    },
    {
      "class": "O_JOINED_EMPTY",
      "description": "Joined values where empty strings create consecutive separators",
      "condition": "Arguments include empty strings (not NULL)",
      "representative_query": "SELECT CONCAT_WS(',', '', 'a', '')"
    },
    {
      "class": "O_EMPTY_SEP",
      "description": "Values concatenated without separator",
      "condition": "Separator is empty string with multiple survivors",
      "representative_query": "SELECT CONCAT_WS('', 'a', 'b', 'c')"
    },
    {
      "class": "O_MULTI_SEP",
      "description": "Values joined with multi-character separator",
      "condition": "Separator has length > 1",
      "representative_query": "SELECT CONCAT_WS('|||', 'a', 'b')"
    }
  ],
  
  "surjectivity_check": {
    "total_classes": 7,
    "covered_classes": 7,
    "coverage": 1.0,
    "uncovered_classes": [],
    "status": "COMPLETE"
  },
  
  "completeness": {
    "input_spanning": true,
    "output_surjectivity": true,
    "basis_size": 25,
    "status": "MATHEMATICALLY COMPLETE",
    "justification": "All separator partitions covered (NULL, empty, single-char, multi-char, non-string). All argument partitions covered (zero args, all NULL, single/multiple survivors, all scalar types, arrays in all forms, mixed types, expressions). All codomain classes hit. Spanning proofs verified. Surjectivity = 1.0."
  }
}
